
// BASES DE DATOS

const galerias = [
    {
        "referencia": "AND",
        "galeria": "Punto de encuentro / Espacio Andreani",
        "ciudad": "",
        "color": "Negro",
        "coordenadas": "-29.154434, -0.351562"
    },
    {
        "referencia": "B11",
        "galeria": "Acéfala",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-65.044605, -117.070313"
    },
    {
        "referencia": "A2",
        "galeria": "Aldo de Sousa",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "67.18368, -36.5625"
    },
    {
        "referencia": "A9",
        "galeria": "Alejandro Faggioni- ESTUDIO DE ARTE",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "58.63937, 68.203125"
    },
    {
        "referencia": "S1",
        "galeria": "AMIA",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-44.828359, -59.765625"
    },
    {
        "referencia": "C2",
        "galeria": "Aninat Galería",
        "ciudad": "Santiago",
        "color": "Rosa",
        "coordenadas": "-6.665184, 106.523438"
    },
    {
        "referencia": "C23",
        "galeria": "ATOCHA",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-56.531496, 120.585938"
    },
    {
        "referencia": "AUD",
        "galeria": "Auditorio",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-63.99517, -70.3125"
    },
    {
        "referencia": "C20",
        "galeria": "AURA VTV",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-60.558889, 96.328125"
    },
    {
        "referencia": "A19",
        "galeria": "Barro",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "36.871963, -55.898438"
    },
    {
        "referencia": "S3",
        "galeria": "Belleza y Felicidad Fiorito",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-51.602343, -59.414063"
    },
    {
        "referencia": "A16",
        "galeria": "Calvaresi",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "46.059544, -12.304688"
    },
    {
        "referencia": "C18",
        "galeria": "Casa Proyecto",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-56.531496, 73.125"
    },
    {
        "referencia": "A21",
        "galeria": "Casa Triângulo",
        "ciudad": "San Pablo",
        "color": "Verde",
        "coordenadas": "57.713291, -60.117188"
    },
    {
        "referencia": "C5",
        "galeria": "Central de Procesos Municipio de San Isidro",
        "ciudad": "",
        "color": "Rosa",
        "coordenadas": "-5.966908, 153.984375"
    },
    {
        "referencia": "C7",
        "galeria": "Centro de Edición",
        "ciudad": "San Martín",
        "color": "Rosa",
        "coordenadas": "-31.335551, 110.390625"
    },
    {
        "referencia": "B4",
        "galeria": "Constitución",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-6.665184, -120.9375"
    },
    {
        "referencia": "A12",
        "galeria": "COSMOCOSA",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "7.379441, 48.164063"
    },
    {
        "referencia": "B13",
        "galeria": "Crudo Rosario",
        "ciudad": "Rosario",
        "color": "Verde",
        "coordenadas": "-64.895987, -144.84375"
    },
    {
        "referencia": "A14",
        "galeria": "Del Infinito",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "43.057019, 14.0625"
    },
    {
        "referencia": "C17",
        "galeria": "Desmayo",
        "ciudad": "Rosario",
        "color": "Rosa",
        "coordenadas": "-53.303318, 65.039063"
    },
    {
        "referencia": "B17",
        "galeria": "Diego Obligado Galería de arte Rosario",
        "ciudad": "Rosario",
        "color": "Verde",
        "coordenadas": "-55.945867, -118.828125"
    },
    {
        "referencia": "C31",
        "galeria": "El Mirador",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-64.74654, 125.859375"
    },
    {
        "referencia": "ESC",
        "galeria": "Espacio para Coleccionistas y Profesionales Santander",
        "ciudad": "",
        "color": "Rosa",
        "coordenadas": "63.626809, 104.238281"
    },
    {
        "referencia": "C21",
        "galeria": "estudio G",
        "ciudad": "Rosario",
        "color": "Rosa",
        "coordenadas": "-57.108208, 103.359375"
    },
    {
        "referencia": "C22",
        "galeria": "Fantazia",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-52.881426, 112.851563"
    },
    {
        "referencia": "S4",
        "galeria": "Fondo Fluido",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-54.960462, -59.414063"
    },
    {
        "referencia": "C26",
        "galeria": "Fuga ",
        "ciudad": "Santa Fe",
        "color": "Rosa",
        "coordenadas": "-53.928424, 144.492188"
    },
    {
        "referencia": "C30",
        "galeria": "Fulana ",
        "ciudad": "Tafí Viejo",
        "color": "Rosa",
        "coordenadas": "-64.74654, 114.257813"
    },
    {
        "referencia": "B1",
        "galeria": "Gabelich Contemporáneo Rosario",
        "ciudad": "Rosario",
        "color": "Verde",
        "coordenadas": "-7.381455, -156.445313"
    },
    {
        "referencia": "A4",
        "galeria": "Gachi Prieto",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "67.204032, 4.570313"
    },
    {
        "referencia": "C19",
        "galeria": "Galería Grasa",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-57.108208, 89.648438"
    },
    {
        "referencia": "A17",
        "galeria": "Galería Nora Fisch",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "36.590436, -23.203125"
    },
    {
        "referencia": "A8",
        "galeria": "Galería Rubbers",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "54.787726, 60.117188"
    },
    {
        "referencia": "A20",
        "galeria": "Galería Sendros",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "51.415492, -59.0625"
    },
    {
        "referencia": "C1",
        "galeria": "Galería van Riel",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-6.316164, 82.617188"
    },
    {
        "referencia": "B15",
        "galeria": "Hache",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-39.345624, -110.390625"
    },
    {
        "referencia": "A15",
        "galeria": "Herlitzka + Faria",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "53.9385, -2.460938"
    },
    {
        "referencia": "INFO",
        "galeria": "Informes",
        "ciudad": "",
        "color": "Negro",
        "coordenadas": "-0.315236, -0.198671"
    },
    {
        "referencia": "C12",
        "galeria": "Intemperie",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-40.690644, 103.007813"
    },
    {
        "referencia": "IED",
        "galeria": "Isla de Ediciones Fundación Proa",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-28.531425, -50.625"
    },
    {
        "referencia": "A22",
        "galeria": "isla flotante",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "56.7629, -81.914063"
    },
    {
        "referencia": "A6",
        "galeria": "Jorge Mara - La Ruche",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "67.339749, 47.109375"
    },
    {
        "referencia": "C24",
        "galeria": "La Arte",
        "ciudad": "Salta",
        "color": "Rosa",
        "coordenadas": "-51.59081, 126.210938"
    },
    {
        "referencia": "C16",
        "galeria": "La copia",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-51.372049, 77.695313"
    },
    {
        "referencia": "C29",
        "galeria": "Luogo",
        "ciudad": "Rafaela",
        "color": "Rosa",
        "coordenadas": "-64.445152, 75.234375"
    },
    {
        "referencia": "A18",
        "galeria": "MARIA CASADO",
        "ciudad": "Béccar",
        "color": "Verde",
        "coordenadas": "7.379441, -36.914063"
    },
    {
        "referencia": "A10",
        "galeria": "MCMC galería",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "41.505536, 71.71875"
    },
    {
        "referencia": "B21",
        "galeria": "Ministerio de Cultura de la Nación",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-44.314662, -81.914063"
    },
    {
        "referencia": "A1",
        "galeria": "Miranda Bosch",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "67.339386, -88.59375"
    },
    {
        "referencia": "B14",
        "galeria": "Mite",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-34.287252, -127.265625"
    },
    {
        "referencia": "C13",
        "galeria": "Moria",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-38.250594, 112.148438"
    },
    {
        "referencia": "S2",
        "galeria": "museo Barda del Desierto",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-48.444306, -59.765625"
    },
    {
        "referencia": "C14",
        "galeria": "NN ",
        "ciudad": "La Plata",
        "color": "Rosa",
        "coordenadas": "-36.01045, 134.648438"
    },
    {
        "referencia": "OGF",
        "galeria": "Obra de Gran Formato Trapiche",
        "ciudad": "Constitución",
        "color": "Negro",
        "coordenadas": "31.288212, -109.335938"
    },
    {
        "referencia": "OGF",
        "galeria": "Obra de Gran Formato Trapiche",
        "ciudad": "Acéfala",
        "color": "Negro",
        "coordenadas": "-1.406109, -82.441406"
    },
    {
        "referencia": "OGF",
        "galeria": "Obra de Gran Formato Trapiche",
        "ciudad": "estudio G",
        "color": "Negro",
        "coordenadas": "8.051474, 101.25"
    },
    {
        "referencia": "C11",
        "galeria": "OHNO",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-40.155818, 81.210938"
    },
    {
        "referencia": "A23",
        "galeria": "OTTO Galería + OdA",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "49.401066, -80.507813"
    },
    {
        "referencia": "B18",
        "galeria": "Pabellón 4 Arte Contemporáneo",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-52.240809, -135"
    },
    {
        "referencia": "C8",
        "galeria": "Palatina",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-31.035039, 79.453125"
    },
    {
        "referencia": "B6",
        "galeria": "Pasto",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-13.918054, -80.859375"
    },
    {
        "referencia": "B5",
        "galeria": "PIEDRAS",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-6.665184, -110.039063"
    },
    {
        "referencia": "B2",
        "galeria": "PM",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-7.013956, -145.546875"
    },
    {
        "referencia": "C25",
        "galeria": "Pólvora",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-50.486486, 137.460938"
    },
    {
        "referencia": "C27",
        "galeria": "Popa Galería de arte",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "-49.81122, 151.171875"
    },
    {
        "referencia": "C9",
        "galeria": "Programa de Arte y Sustentabilidad Zurich",
        "ciudad": "",
        "color": "Rosa",
        "coordenadas": "-19.632751, 47.109375"
    },
    {
        "referencia": "C6",
        "galeria": "Programa de Perfomance Fundación Williams",
        "ciudad": "",
        "color": "Rosa",
        "coordenadas": "-30.127816, 148.007813"
    },
    {
        "referencia": "C10",
        "galeria": "Programa de Videos Patio Bullrich",
        "ciudad": "",
        "color": "Rosa",
        "coordenadas": "-33.118359, 48.867188"
    },
    {
        "referencia": "B10",
        "galeria": "Quimera",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-52.881426, -96.328125"
    },
    {
        "referencia": "C15",
        "galeria": "Remota",
        "ciudad": "Salta",
        "color": "Rosa",
        "coordenadas": "-36.01045, 146.953125"
    },
    {
        "referencia": "B16",
        "galeria": "Revolver galería",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-47.727957, -114.257813"
    },
    {
        "referencia": "A11",
        "galeria": "Roldan Moderno",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "36.036024, 48.515625"
    },
    {
        "referencia": "A3",
        "galeria": "Rolf Art",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "67.204032, -14.0625"
    },
    {
        "referencia": "A13",
        "galeria": "Ruth Benzacar Galería de Arte",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "26.116767, -1.757813"
    },
    {
        "referencia": "C3",
        "galeria": "Sasha D espacio de arte",
        "ciudad": "Córdoba",
        "color": "Rosa",
        "coordenadas": "-5.966908, 121.640625"
    },
    {
        "referencia": "C32",
        "galeria": "Satélite",
        "ciudad": "Córdoba",
        "color": "Rosa",
        "coordenadas": "-64.445152, 136.40625"
    },
    {
        "referencia": "YPF",
        "galeria": "Sección arte + impacto social YPF",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-51.182616, -73.476563"
    },
    {
        "referencia": "B8",
        "galeria": "Selvanegra",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-33.996522, -87.890625"
    },
    {
        "referencia": "B19",
        "galeria": "Smart Gallery",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-43.809829, -130.078125"
    },
    {
        "referencia": "B9",
        "galeria": "Sputnik",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-44.314662, -91.757812"
    },
    {
        "referencia": "B20",
        "galeria": "Stand Institucional Banco Ciudad",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-21.278292, -72.773438"
    },
    {
        "referencia": "A5",
        "galeria": "Sur",
        "ciudad": "Montevideo",
        "color": "Rosa",
        "coordenadas": "67.204032, 23.554688"
    },
    {
        "referencia": "B7",
        "galeria": "The White Lodge",
        "ciudad": "Córdoba",
        "color": "Verde",
        "coordenadas": "-24.193659, -84.023438"
    },
    {
        "referencia": "B12",
        "galeria": "Tokonoma_OM",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "-64.895987, -129.023438"
    },
    {
        "referencia": "C28",
        "galeria": "Valerie",
        "ciudad": "Mendoza",
        "color": "Rosa",
        "coordenadas": "-64.596263, 64.6875"
    },
    {
        "referencia": "A7",
        "galeria": "Vasari",
        "ciudad": "Buenos Aires",
        "color": "Rosa",
        "coordenadas": "51.851549, 41.484375"
    },
    {
        "referencia": "C4",
        "galeria": "Vía Margutta Arte Contemporáneo",
        "ciudad": "Córdoba",
        "color": "Rosa",
        "coordenadas": "-6.665184, 137.109375"
    },
    {
        "referencia": "B3",
        "galeria": "Vigil Gonzales",
        "ciudad": "Cusco",
        "color": "Verde",
        "coordenadas": "-5.966908, -132.1875"
    },
    {
        "referencia": "VG",
        "galeria": "Visitas guiadas de arte GCBA",
        "ciudad": "",
        "color": "Verde",
        "coordenadas": "-20.008789, -156.09375"
    },
    {
        "referencia": "A24",
        "galeria": "W",
        "ciudad": "Buenos Aires",
        "color": "Verde",
        "coordenadas": "35.782292, -78.046875"
    }
]
    
/* CREA BOTONERA */

    for (const galeria of galerias) {
        let lista = document.createElement("div");
        lista.innerHTML = `
        <button type="button" class="list-group-item list-group-item-action border-top border-right-0 border-bottom-0 border-left-0 border-dark ${galeria.color}" value="${galeria.coordenadas}" onclick="popup('${galeria.galeria}', '${galeria.coordenadas}')"><span style="font-family: 'Dapper Bold'">${galeria.galeria}</span> ${galeria.ciudad}</button>
                    `;
        var obras = document.getElementById("select-location")
        obras.appendChild(lista);
        }

// CREA MARCADORES Y POPUP

var marker 

function popup (gal, cor) {
    map.removeLayer(marker)
    let coordenada = cor.split(",")
    marker = L.marker(coordenada).bindPopup(gal).addTo(map).openPopup()}
    document.getElementById('select-location').addEventListener('click',function(e){
        let coords = e.target.value.split(",");
        map.setView(coords,2);
    })


// FUNCION VER MAPA COMPLETO


// CREA MAPA
var mapSW = [-82, -270],
    mapNE = [82, 270]

var map = L.map('map', { zoomControl: false, attributionControl: false }).setView([0, 0], 0);

map.setMaxBounds(new L.LatLngBounds(
    mapSW,
    mapNE
));
var bounds = L.latLngBounds(mapSW, mapNE);
map.setMaxBounds(bounds);

map.on('drag', function() {
    map.panInsideBounds(bounds, { animate: false });
 });

L.tileLayer('maps/map_arteba/{z}/{x}/{y}.png', {
    minZoom: 0,
    maxZoom: 4,
    continuousWorld: false,
    noWrap: true,
    crs: L.CRS.Simple,
}).addTo(map)

// SELECTOR DE COORDENADAS

var marker = L.marker([0, 0], {
    draggable: true,
})/* .addTo(map) */; // Se activa cuando se habilita el addTo(map)
marker.bindPopup('');

marker.on('dragend', function(e) {
    marker.getPopup().setContent('Clicked' + marker.getLatLng().toString()).openOn(map)
} );

    // Inicializa la detección de agitación usando shake.js
    var myShakeEvent = new Shake({
        threshold: 20, // Umbral de agitación
        timeout: 1000 // Tiempo de espera entre agitaciones
    });

    // Función para manejar la agitación
    function handleShake() {
        // Realiza la acción que deseas cuando se agita el teléfono
        map.flyTo([0, 0],0);;
    }

    // Agregar un event listener para el evento 'shake'
    myShakeEvent.start();
    window.addEventListener('shake', handleShake, false);



// Geolocalización

/* navigator.geolocation.getCurrentPosition(function(position) {
  var latitude = position.coords.latitude;
  var longitude = position.coords.longitude;

    var marker = L.marker([latitude, longitude]).addTo(mymap);
}) */

/* BUSCADOR */

$(document).ready(function(){
                $("#myInput").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#select-location button").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
                });
            });

// FUNCION USTED ESTA AQUI

window.onload = function(){
    try{
    var url_string = (window.top.location.href).toLowerCase()
    var url = new URL(url_string)
    var ubicacion = url.searchParams.get("ubicacion")
    if(ubicacion == 'plaza1') {
        map.flyTo([60.382757, -41.132813],2);
L.marker([60.382757, -41.132813]).bindPopup('Usted está aquí').addTo(map).openPopup();
     } 
     if(ubicacion == 'plaza2') {
        map.flyTo([62.724032, 13.710938],2);
L.marker([62.724032, 13.710938]).bindPopup('Usted está aquí').addTo(map).openPopup();
     } 
     if(ubicacion == 'plaza3') {
        map.flyTo([15.948499, -82.617188],2);
L.marker([15.948499, -82.617188]).bindPopup('Usted está aquí').addTo(map).openPopup();
     } 
     if(ubicacion == 'plaza4') {
        map.flyTo([31.629919, 22.5],2);
L.marker([31.629919, 22.5]).bindPopup('Usted está aquí').addTo(map).openPopup();
     } 
     if(ubicacion == 'plaza5') {
        map.flyTo([16.62285, 81.5625],2);
L.marker([16.62285, 81.5625]).bindPopup('Usted está aquí').addTo(map).openPopup();
     } 
     if(ubicacion == 'plaza6') {
        map.flyTo([-18.563016, -108.808594],2);
L.marker([-18.563016, -108.808594]).bindPopup('Usted está aquí').addTo(map).openPopup();
     } 
    if(ubicacion == 'plaza7') {
        map.flyTo([-42.535982, 90],2);
L.marker([-42.535982, 90]).bindPopup('Usted está aquí').addTo(map).openPopup();
     } 

    } catch (err) {console.log("Problemas!  " + err)}
}